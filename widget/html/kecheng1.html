<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../css/aui.css">
    <link rel="stylesheet" href="../css/iconfont/iconfont.css">
</head>
<style media="screen">
    header {
        position: fixed !important;
        width: 100%;
        font-size: 1rem;
    }

    header i {
        color: #222222;
        font-size: 1rem !important;
        font-weight: 600;
    }

    .db {
        background: #fff;
        line-height: 1.5rem;
    }

    .color-33 {
        color: #333;
    }

    .color-99 {
        color: #999;
    }

    .color-22 {
        color: #222;
    }

    .color-76 {
        color: #76D166;
    }

    .color-ff {
        color: #ff6655;
    }

    .aui-hr {
        background-size: 90% 1px;
    }

    .aui-padded-15 img {
        margin: 0 auto;
    }

    .main_3 i {
        float: right;
        font-size: 1rem !important;
    }

    .main_3 p {
        color: #222;
        font-size: 0.75rem;
    }

    .main_3 {
        width: 100%;
        background: #fff;
        margin: 1rem auto;
        font-size: 0.8rem;
        height: 2.5rem;
        line-height: 2.5rem;
    }

    .pad {
        padding-top: 3.5rem;
    }

    .title {
        height: 3rem;
        line-height: 3rem;
        padding-left: 1rem;
    }

    .con {
        background: #F9F9F9;
    }

    .nr {
        background: #fff;
        height: 2.5rem;
        line-height: 2.5rem;
    }

    .bm {
        width: 100%;
        height: 2.5rem;
        line-height: 2.5rem;
    }

    .bm p {
        float: left;
    }

    .bm i {
        font-size: 1rem;
    }

    .xm {
        overflow: hidden;
        height: auto;
        background: #fff;
    }

    .xm p {
        display: block;
        background: #fff;
        line-height: 2rem;
        height: 2rem;
    }

    .cn {}

    .cn_nav {
        height: 2.5rem;
        line-height: 2.5rem;
        background-color: #fff;
    }

    .ds_con {
        background: #fff;
    }

    .bt {
        text-align: center;
        background: #fff;
        padding: 0.5rem 0 0.5rem 0;
        position: relative;
        ;
        bottom: 0;
        width: 100%;
    }

    .bt button {
        width: 80%;
        text-align: center;
        border-radius: 4px;
        height: 2.5rem;
        font-size: 0.85rem;
        outline: none;
        border: 0;
        background: #4593de;
        color: #fff;
    }
</style>

<body>
    <header class="aui-bar aui-bar-nav" id="header">
        <a class="aui-pull-left" tapmode onclick="fh()">
            <i class="iconfont icon-arrow-left aui-iconfont"></i>
        </a>
        <div class="aui-title">课程内容</div>
    </header>
    <div class="pad"></div>

    <div class="db ">
        <div class="title">
            <p class="aui-font-size-18 color-22 chu" id="name">脑干网状结构小脑</p>
        </div>
        <div class="aui-padded-15 con">
            <p class="aui-font-size-16 color-33" id="content">2018年1月5日开始《住院医师系统科室主任出题操作手册》新版颁布。规培办会按照新的《住院医师系统科室主任出题操作手册》对住院医师进行规培。如有疑问，请咨询规培办！2018年1月5日开始《住院医师系统科室主任出题操作手册》新版颁布。规培办会按照新的《住院医师系统科室主任出题操作手册》对住院医师进行规培。如有疑问，请咨询规培办！</p>
        </div>
    </div>

    <div class="cn">
        <div class="cn_nav">
            <p class="aui-font-size-16 aui-padded-l-15 clo-33">发布人:<span class=" aui-padded-l-15" id="username"></span></p>
            <div class="aui-hr"></div>
        </div>
        <div class="cn_nav ">
            <p class="aui-font-size-16 aui-padded-l-15 clo-33">发布日期:<span class="  aui-padded-l-15" id="public_at"></span></p>
        </div>
    </div>
    <div class="aui-margin-t-15  aui-margin-b-15">
        <div class="nr ">
            <p class="aui-font-size-16 clo-33 aui-padded-l-15"> 课程开始时间：<span id="start_time"></span></p>
            <div class="aui-hr"></div>
        </div>

        <div class="nr ">
            <p class="aui-font-size-16 clo-33  aui-padded-l-15"> 课程地点：<span id="place"></span></p>
            <div class="aui-hr"></div>
        </div>
        <div class="nr  ">
            <p class="aui-font-size-16 clo-33  aui-padded-l-15"> 课程人数：<span id="people_num"></span></p>
            <div class="aui-hr"></div>
        </div>
        <div class="nr  ">
            <p class="aui-font-size-16 clo-33  aui-padded-l-15"> 课程讲师：<span id="course_teacher"></span></p>
            <div class="aui-hr"></div>
        </div>
    </div>
    <div class="nr">
        <div class="bm" tapmode onclick="cyry()">
            <i class="iconfont icon-about-us aui-pull-left color-76 aui-font-size-20 aui-padded-l-5 aui-padded-r-15"></i>
            <p class="aui-font-size-16 color-22">已报名参加人员(<span class="clo-99" id="people_list_num"></span>)</p>
            <i class="iconfont icon-arrow-right aui-pull-right clo-22 aui-padded-r-10"></i>
        </div>
        <!-- <div class="aui-hr"></div> -->
    </div>
    <div class="xm" id="xm">
        <div v-for="item in list">
            <p class="aui-font-size-14 color-33 aui-col-xs-3 aui-text-center"> {{item.name}}</p>
        </div>
    </div>

    <div class=" bt aui-margin-t-15" >
        <button tapmode onclick="showDefault('success')" id="canjia">参加课程</button>
        <button>已参加</button>
    </div>

</body>
<script src="../script/api.js"></script>
<script src="../script/AHelper.js"></script>
<script src="../script/aui-toast.js"></script>
<script src="../script/zepto.min.js"></script>
<script src="../script/base.js"></script>
<script src="../script/vue/vue.min.js"></script>
<script>
    var vm = new Vue({
        el: "#xm",
        data: {
            list: []
        },
        methods: {
            select: function(id) {
                H.setStorage("course_id", id);
                api.openWin({
                    name: 'kc1',
                    url: './kecheng1.html',
                    pageParam: {
                        name: 'test'
                    }
                });
            },
        },
    })

    function fh() {
        api.closeWin({});
    }

    function cyry() {
        H.setStorage("panduan", "kc");
        api.openWin({
            name: 'cyry',
            url: './canyury.html',
            pageParam: {
                name: 'test'
            }
        });

    }
    var toast = new auiToast({})

    function showDefault(type) {
        var address = "/Hospital/index.php/api/user/course";
        var token = H.getStorage('token');
        var course_id = H.getStorage('course_id');
        var ajaxData = {
            token: token,
            action: "participate",
            id: course_id
        };
        $base.get(address, ajaxData, function(ret) {
            console.log(JSON.stringify(ret));
            if (ret.status == 1) {
                switch (type) {
                    case "success":
                        toast.success({
                            title: "参加成功",
                            duration: 2000
                        });
                }
                setTimeout(function () {
                  location.reload();
                },1000)

            } else {
                switch (type) {
                    case "success":
                        toast.success({
                            title: "参加失败",
                            duration: 2000
                        });
                }
            }
        }, function(err) {
            console.log(JSON.stringify(err));
        });

    }

    H.ready(function() {
        var address = "/Hospital/index.php/api/user/course";
        var token = H.getStorage('token');
        var course_id = H.getStorage('course_id');
        $base.showLoading();
        var ajaxData = {
            token: token,
            action: "detail",
            id: course_id
        };
        $base.get(address, ajaxData, function(ret) {
            console.log(JSON.stringify(ret));
            $("#name").html(ret.data.name);
            $("#content").html(ret.data.content);
            $("#public_at").html(ret.data.public_at);
            $("#start_time").html(ret.data.start_time);
            $("#place").html(ret.data.place);
            $("#course_teacher").html(ret.data.course_teacher);
            $("#username").html(ret.data.public_user);
            $("#people_num").html(ret.data.people_num + "人");
            $("#people_list_num").html(ret.data.people_list_num + "人");
            var dd = ret.data.people_list.slice(0, 8);
            if(ret.data.sign_status == 0){
              $('#canjia').show().siblings().hide()
            }else {
              $('#canjia').hide().siblings().show()
            }
            vm.list = dd;
            $base.closeLoading();
        }, function(err) {
            console.log(JSON.stringify(err));
        });
    })
</script>

</html>
